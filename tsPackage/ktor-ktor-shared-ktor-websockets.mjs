import {
  collectionSizeOrDefault36dulx8yinfqm as collectionSizeOrDefault,
  mapCapacity1h45rc3eh9p2l as mapCapacity,
  coerceAtLeast2bkz8m9ik7hep as coerceAtLeast,
  LinkedHashMap_init_$Create$snys8oz8txtu as LinkedHashMap_init_$Create$,
  Unit_instanceat14thlj150z as Unit_instance,
  protoOf180f3jzyo7rfj as protoOf,
  initMetadataForCompanion1wyw17z38v6ac as initMetadataForCompanion,
  enumEntries20mr21zbe3az4 as enumEntries,
  objectCreate1ve4bgxiu4x98 as objectCreate,
  Enum3alwj03lh1n41 as Enum,
  initMetadataForClassbxx6q50dy2s7 as initMetadataForClass,
  VOID7hggqo3abtya as VOID,
  toString1pkumu07cwy4m as toString,
  getStringHashCode26igk1bx568vk as getStringHashCode,
  THROW_CCE2g6jy02ryeudk as THROW_CCE,
  initMetadataForInterface1egvbzx539z91 as initMetadataForInterface,
  Long2qws0ah9gnpki as Long,
  isInterface3d6p8outrmvmk as isInterface,
  IllegalArgumentException_init_$Create$sfel9vrfa7w2 as IllegalArgumentException_init_$Create$,
  CoroutineImpl2sn3kjnwmfr10 as CoroutineImpl,
  get_COROUTINE_SUSPENDED3ujt3p13qm4iy as get_COROUTINE_SUSPENDED,
  ensureNotNull1e947j3ixpazm as ensureNotNull,
  initMetadataForLambda3af3he42mmnh as initMetadataForLambda,
  CancellationException_init_$Create$1eqo789zqov68 as CancellationException_init_$Create$,
  CancellationException3b36o9qz53rgr as CancellationException,
  initMetadataForCoroutine1i7lbatuf5bnt as initMetadataForCoroutine,
  toString30pk9tzaqopn as toString_0,
  toLongw1zpgk99d84b as toLong,
  ArrayList_init_$Create$2rimpp4x9tjd3 as ArrayList_init_$Create$,
  IllegalStateException_init_$Create$1nm9y6jd3c9iy as IllegalStateException_init_$Create$,
  joinToString1cxrrlmo0chqs as joinToString,
  initMetadataForObject1cxne3s9w65el as initMetadataForObject,
  Exceptiondt2hlxn7j7vw as Exception,
  Exception_init_$Init$25rnrjp6anyxk as Exception_init_$Init$,
  captureStack1fzi4aczwc4hg as captureStack,
  defineProp3hxgpk2knu2px as defineProp,
  compareTo3ankvs086tmwq as compareTo,
  fillArrayVali8eppxapiek4 as fillArrayVal,
  decodeToString1dbzcjd620q25 as decodeToString,
  Randomei1bbeye8rr8 as Random,
  ArrayList_init_$Create$3m1kyiqequwm5 as ArrayList_init_$Create$_0,
  split2bvyvnrlcifjv as split,
  first58ocm7j58k3q as first,
  isCharSequence1ju9jr1w86plq as isCharSequence,
  trim11nh7r46at6sx as trim,
  drop3na99dw9feawf as drop,
  noWhenBranchMatchedException2a6r7ubxgky5j as noWhenBranchMatchedException,
} from './kotlin-kotlin-stdlib.mjs';
import {
  Dispatchers_getInstance2xomc0oxzllw9 as Dispatchers_getInstance,
  launch1c91vkjzdi9sd as launch,
  CoroutineStart_UNDISPATCHED_getInstance36t7e2kqqnuqp as CoroutineStart_UNDISPATCHED_getInstance,
  ChannelResult2y4k69ac6y3du as ChannelResult,
  _ChannelResult___get_isSuccess__impl__odq1z92rhkz5ot7gudq as _ChannelResult___get_isSuccess__impl__odq1z9,
  CoroutineScopefcb5f5dwqcas as CoroutineScope,
  cancelConsumed2i0oizqhmljf6 as cancelConsumed,
  ClosedSendChannelException29m33prpq9jaw as ClosedSendChannelException,
  ClosedReceiveChannelException3ofg6gf5f5b38 as ClosedReceiveChannelException,
  CompletableDeferred2lnqvsbvx74d3 as CompletableDeferred,
  Channel3r72atmcithql as Channel,
  Key_instance2expa55gr45sc as Key_instance,
  Job13y4jkazwjho0 as Job,
  CoroutineName2g5zosw74tf0f as CoroutineName,
  CopyableThrowable1mvc99jcyvivf as CopyableThrowable,
  withTimeoutOrNullttha8n980jxd as withTimeoutOrNull,
} from './kotlinx-coroutines-core.mjs';
import {
  get_isTraceEnabled82xibuu04nxp as get_isTraceEnabled,
  ChannelIOException2i3t76lsrbgox as ChannelIOException,
  KtorSimpleLogger1xdphsp5l4e48 as KtorSimpleLogger,
  initCauseBridge1upxfqhavblt6 as initCauseBridge,
  getTimeMillis12o7k17x9fmwi as getTimeMillis,
  hex2ofqpe9ngcu1i as hex,
} from './ktor-ktor-utils.mjs';
import {
  BytePacketBuilder2biodf4wxvlba as BytePacketBuilder,
  writeFully359t6q8kam2g5 as writeFully,
  buildjygoh729rhy8 as build,
  get_size2imoy2jq11jxl as get_size,
  Charsets_getInstance193f5sla8amhs as Charsets_getInstance,
  decode1t43jmuxrxpmo as decode,
  readText27783kyxjxi1g as readText,
  toByteArray1i3ns5jnoqlv6 as toByteArray,
  writeText19qfzm98fbm4l as writeText,
} from './ktor-ktor-io.mjs';
import {
  readByteArray1ri21h2rciakw as readByteArray,
  IOException_init_$Create$2ud7rnqxh44u0 as IOException_init_$Create$,
  Buffergs925ekssbch as Buffer,
} from './kotlinx-io-kotlinx-io-core.mjs';
import {
  atomic$ref$130aurmcwdfdf1 as atomic$ref$1,
  atomic$boolean$1iggki4z65a2h as atomic$boolean$1,
} from './kotlinx-atomicfu.mjs';
//region block: imports
var imul = Math.imul;
//endregion
//region block: pre-declaration
initMetadataForCompanion(Companion);
initMetadataForClass(Codes, 'Codes', VOID, Enum);
initMetadataForClass(CloseReason, 'CloseReason');
function send(frame, $completion) {
  return this.g2x().m17(frame, $completion);
}
initMetadataForInterface(WebSocketSession, 'WebSocketSession', VOID, VOID, [CoroutineScope], [1, 0]);
initMetadataForInterface(DefaultWebSocketSession, 'DefaultWebSocketSession', VOID, VOID, [WebSocketSession], [1, 0]);
initMetadataForCompanion(Companion_0);
initMetadataForLambda(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForCoroutine($outgoingProcessorLoopCOROUTINE$0, CoroutineImpl);
initMetadataForCoroutine($sendCloseSequenceCOROUTINE$1, CoroutineImpl);
initMetadataForCoroutine($checkMaxFrameSizeCOROUTINE$2, CoroutineImpl);
initMetadataForClass(DefaultWebSocketSessionImpl, 'DefaultWebSocketSessionImpl', VOID, VOID, [DefaultWebSocketSession, WebSocketSession], [1, 0, 2]);
initMetadataForObject(NonDisposableHandle, 'NonDisposableHandle');
initMetadataForClass(FrameTooBigException, 'FrameTooBigException', VOID, Exception, [Exception, CopyableThrowable]);
initMetadataForCompanion(Companion_1);
initMetadataForClass(FrameType, 'FrameType', VOID, Enum);
initMetadataForLambda(ponger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda_1, CoroutineImpl, VOID, [1]);
initMetadataForLambda(pinger$slambda, CoroutineImpl, VOID, [1]);
initMetadataForInterface(WebSocketExtension, 'WebSocketExtension');
initMetadataForClass(WebSocketExtensionsConfig, 'WebSocketExtensionsConfig', WebSocketExtensionsConfig);
initMetadataForClass(WebSocketExtensionHeader, 'WebSocketExtensionHeader');
initMetadataForCoroutine($closeCOROUTINE$3, CoroutineImpl);
initMetadataForClass(Frame, 'Frame');
initMetadataForClass(Binary, 'Binary', VOID, Frame);
initMetadataForClass(Text, 'Text', VOID, Frame);
initMetadataForClass(Close, 'Close', Close_init_$Create$_0, Frame);
initMetadataForClass(Ping, 'Ping', VOID, Frame);
initMetadataForClass(Pong, 'Pong', VOID, Frame);
initMetadataForCompanion(Companion_2);
//endregion
var Codes_NORMAL_instance;
var Codes_GOING_AWAY_instance;
var Codes_PROTOCOL_ERROR_instance;
var Codes_CANNOT_ACCEPT_instance;
var Codes_CLOSED_ABNORMALLY_instance;
var Codes_NOT_CONSISTENT_instance;
var Codes_VIOLATED_POLICY_instance;
var Codes_TOO_BIG_instance;
var Codes_NO_EXTENSION_instance;
var Codes_INTERNAL_ERROR_instance;
var Codes_SERVICE_RESTART_instance;
var Codes_TRY_AGAIN_LATER_instance;
function Companion() {
  Companion_instance = this;
  var tmp = this;
  // Inline function 'kotlin.collections.associateBy' call
  var this_0 = get_entries();
  var capacity = coerceAtLeast(mapCapacity(collectionSizeOrDefault(this_0, 10)), 16);
  // Inline function 'kotlin.collections.associateByTo' call
  var destination = LinkedHashMap_init_$Create$(capacity);
  var tmp0_iterator = this_0.p();
  while (tmp0_iterator.q()) {
    var element = tmp0_iterator.r();
    // Inline function 'io.ktor.websocket.Companion.byCodeMap.<anonymous>' call
    var tmp$ret$0 = element.u2w_1;
    destination.r2(tmp$ret$0, element);
  }
  tmp.v2w_1 = destination;
  this.w2w_1 = Codes_INTERNAL_ERROR_getInstance();
}
protoOf(Companion).x2w = function (code) {
  return this.v2w_1.o2(code);
};
var Companion_instance;
function Companion_getInstance() {
  Codes_initEntries();
  if (Companion_instance == null)
    new Companion();
  return Companion_instance;
}
function values() {
  return [Codes_NORMAL_getInstance(), Codes_GOING_AWAY_getInstance(), Codes_PROTOCOL_ERROR_getInstance(), Codes_CANNOT_ACCEPT_getInstance(), Codes_CLOSED_ABNORMALLY_getInstance(), Codes_NOT_CONSISTENT_getInstance(), Codes_VIOLATED_POLICY_getInstance(), Codes_TOO_BIG_getInstance(), Codes_NO_EXTENSION_getInstance(), Codes_INTERNAL_ERROR_getInstance(), Codes_SERVICE_RESTART_getInstance(), Codes_TRY_AGAIN_LATER_getInstance()];
}
function get_entries() {
  if ($ENTRIES == null)
    $ENTRIES = enumEntries(values());
  return $ENTRIES;
}
var Codes_entriesInitialized;
function Codes_initEntries() {
  if (Codes_entriesInitialized)
    return Unit_instance;
  Codes_entriesInitialized = true;
  Codes_NORMAL_instance = new Codes('NORMAL', 0, 1000);
  Codes_GOING_AWAY_instance = new Codes('GOING_AWAY', 1, 1001);
  Codes_PROTOCOL_ERROR_instance = new Codes('PROTOCOL_ERROR', 2, 1002);
  Codes_CANNOT_ACCEPT_instance = new Codes('CANNOT_ACCEPT', 3, 1003);
  Codes_CLOSED_ABNORMALLY_instance = new Codes('CLOSED_ABNORMALLY', 4, 1006);
  Codes_NOT_CONSISTENT_instance = new Codes('NOT_CONSISTENT', 5, 1007);
  Codes_VIOLATED_POLICY_instance = new Codes('VIOLATED_POLICY', 6, 1008);
  Codes_TOO_BIG_instance = new Codes('TOO_BIG', 7, 1009);
  Codes_NO_EXTENSION_instance = new Codes('NO_EXTENSION', 8, 1010);
  Codes_INTERNAL_ERROR_instance = new Codes('INTERNAL_ERROR', 9, 1011);
  Codes_SERVICE_RESTART_instance = new Codes('SERVICE_RESTART', 10, 1012);
  Codes_TRY_AGAIN_LATER_instance = new Codes('TRY_AGAIN_LATER', 11, 1013);
  Companion_getInstance();
}
var $ENTRIES;
function CloseReason_init_$Init$(code, message, $this) {
  CloseReason.call($this, code.u2w_1, message);
  return $this;
}
function CloseReason_init_$Create$(code, message) {
  return CloseReason_init_$Init$(code, message, objectCreate(protoOf(CloseReason)));
}
function Codes(name, ordinal, code) {
  Enum.call(this, name, ordinal);
  this.u2w_1 = code;
}
function Codes_NORMAL_getInstance() {
  Codes_initEntries();
  return Codes_NORMAL_instance;
}
function Codes_GOING_AWAY_getInstance() {
  Codes_initEntries();
  return Codes_GOING_AWAY_instance;
}
function Codes_PROTOCOL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_PROTOCOL_ERROR_instance;
}
function Codes_CANNOT_ACCEPT_getInstance() {
  Codes_initEntries();
  return Codes_CANNOT_ACCEPT_instance;
}
function Codes_CLOSED_ABNORMALLY_getInstance() {
  Codes_initEntries();
  return Codes_CLOSED_ABNORMALLY_instance;
}
function Codes_NOT_CONSISTENT_getInstance() {
  Codes_initEntries();
  return Codes_NOT_CONSISTENT_instance;
}
function Codes_VIOLATED_POLICY_getInstance() {
  Codes_initEntries();
  return Codes_VIOLATED_POLICY_instance;
}
function Codes_TOO_BIG_getInstance() {
  Codes_initEntries();
  return Codes_TOO_BIG_instance;
}
function Codes_NO_EXTENSION_getInstance() {
  Codes_initEntries();
  return Codes_NO_EXTENSION_instance;
}
function Codes_INTERNAL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_INTERNAL_ERROR_instance;
}
function Codes_SERVICE_RESTART_getInstance() {
  Codes_initEntries();
  return Codes_SERVICE_RESTART_instance;
}
function Codes_TRY_AGAIN_LATER_getInstance() {
  Codes_initEntries();
  return Codes_TRY_AGAIN_LATER_instance;
}
function CloseReason(code, message) {
  this.y2w_1 = code;
  this.z2w_1 = message;
}
protoOf(CloseReason).a2x = function () {
  return Companion_getInstance().x2w(this.y2w_1);
};
protoOf(CloseReason).toString = function () {
  var tmp0_elvis_lhs = this.a2x();
  return 'CloseReason(reason=' + toString(tmp0_elvis_lhs == null ? this.y2w_1 : tmp0_elvis_lhs) + ', message=' + this.z2w_1 + ')';
};
protoOf(CloseReason).hashCode = function () {
  var result = this.y2w_1;
  result = imul(result, 31) + getStringHashCode(this.z2w_1) | 0;
  return result;
};
protoOf(CloseReason).equals = function (other) {
  if (this === other)
    return true;
  if (!(other instanceof CloseReason))
    return false;
  var tmp0_other_with_cast = other instanceof CloseReason ? other : THROW_CCE();
  if (!(this.y2w_1 === tmp0_other_with_cast.y2w_1))
    return false;
  if (!(this.z2w_1 === tmp0_other_with_cast.z2w_1))
    return false;
  return true;
};
function get_LOGGER() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return LOGGER;
}
var LOGGER;
function get_IncomingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return IncomingProcessorCoroutineName;
}
var IncomingProcessorCoroutineName;
function get_OutgoingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return OutgoingProcessorCoroutineName;
}
var OutgoingProcessorCoroutineName;
function get_NORMAL_CLOSE() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return NORMAL_CLOSE;
}
var NORMAL_CLOSE;
function DefaultWebSocketSession() {
}
function DefaultWebSocketSession_0(session, pingIntervalMillis, timeoutMillis) {
  pingIntervalMillis = pingIntervalMillis === VOID ? new Long(0, 0) : pingIntervalMillis;
  timeoutMillis = timeoutMillis === VOID ? new Long(15000, 0) : timeoutMillis;
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  // Inline function 'kotlin.require' call
  // Inline function 'kotlin.contracts.contract' call
  if (!!isInterface(session, DefaultWebSocketSession)) {
    // Inline function 'io.ktor.websocket.DefaultWebSocketSession.<anonymous>' call
    var message = 'Cannot wrap other DefaultWebSocketSession';
    throw IllegalArgumentException_init_$Create$(toString(message));
  }
  return new DefaultWebSocketSessionImpl(session, pingIntervalMillis, timeoutMillis);
}
function runIncomingProcessor($this, ponger) {
  var tmp = get_IncomingProcessorCoroutineName().qi(Dispatchers_getInstance().uz_1);
  return launch($this, tmp, VOID, DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0($this, ponger, null));
}
function runOutgoingProcessor($this) {
  var tmp = get_OutgoingProcessorCoroutineName().qi(Dispatchers_getInstance().uz_1);
  var tmp_0 = CoroutineStart_UNDISPATCHED_getInstance();
  return launch($this, tmp, tmp_0, DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0($this, null));
}
function outgoingProcessorLoop($this, $completion) {
  var tmp = new $outgoingProcessorLoopCOROUTINE$0($this, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
}
function sendCloseSequence($this, reason, exception, $completion) {
  var tmp = new $sendCloseSequenceCOROUTINE$1($this, reason, exception, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
}
function sendCloseSequence$default($this, reason, exception, $completion, $super) {
  exception = exception === VOID ? null : exception;
  return sendCloseSequence($this, reason, exception, $completion);
}
function tryClose($this) {
  return $this.o2y_1.atomicfu$compareAndSet(false, true);
}
function runOrCancelPinger($this) {
  var interval = $this.t2y_1;
  var tmp;
  if ($this.o2y_1.kotlinx$atomicfu$value) {
    tmp = null;
  } else if (interval.g1(new Long(0, 0)) > 0) {
    var tmp_0 = $this.j2y_1.g2x();
    var tmp_1 = $this.u2y_1;
    tmp = pinger($this, tmp_0, interval, tmp_1, DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0($this, null));
  } else {
    tmp = null;
  }
  var newPinger = tmp;
  var tmp0_safe_receiver = $this.k2y_1.atomicfu$getAndSet(newPinger);
  if (tmp0_safe_receiver == null)
    null;
  else
    tmp0_safe_receiver.w17();
  var tmp2_safe_receiver = newPinger == null ? null : new ChannelResult(newPinger.n17(Companion_getInstance_0().w2y_1));
  if (tmp2_safe_receiver == null)
    null;
  else
    _ChannelResult___get_isSuccess__impl__odq1z9(tmp2_safe_receiver.d14_1);
  if ($this.o2y_1.kotlinx$atomicfu$value && !(newPinger == null)) {
    runOrCancelPinger($this);
  }
}
function checkMaxFrameSize($this, packet, frame, $completion) {
  var tmp = new $checkMaxFrameSizeCOROUTINE$2($this, packet, frame, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
}
function processIncomingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var tmp0_iterator = $this.j2z().p();
  while (tmp0_iterator.q()) {
    var element = tmp0_iterator.r();
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.processIncomingExtensions.<anonymous>' call
    var current = accumulator;
    accumulator = element.k2z(current);
  }
  return accumulator;
}
function processOutgoingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var tmp0_iterator = $this.j2z().p();
  while (tmp0_iterator.q()) {
    var element = tmp0_iterator.r();
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.processOutgoingExtensions.<anonymous>' call
    var current = accumulator;
    accumulator = element.l2z(current);
  }
  return accumulator;
}
function Companion_0() {
  Companion_instance_0 = this;
  this.w2y_1 = new Pong(new Int8Array(0), NonDisposableHandle_instance);
}
var Companion_instance_0;
function Companion_getInstance_0() {
  if (Companion_instance_0 == null)
    new Companion_0();
  return Companion_instance_0;
}
function DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this$0, $ponger, resultContinuation) {
  this.u2z_1 = this$0;
  this.v2z_1 = $ponger;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).k1r = function ($this$launch, $completion) {
  var tmp = this.l1r($this$launch, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 39;
          this.x2z_1 = null;
          this.y2z_1 = null;
          this.z2z_1 = false;
          this.a30_1 = Unit_instance;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          this.f9_1 = 2;
          continue $sm;
        case 2:
          this.g9_1 = 33;
          this.g9_1 = 32;
          var tmp_0 = this;
          tmp_0.c30_1 = this.u2z_1.j2y_1.f2x();
          this.f9_1 = 3;
          continue $sm;
        case 3:
          var tmp_1 = this;
          tmp_1.e30_1 = this.c30_1;
          this.f30_1 = null;
          this.f9_1 = 4;
          continue $sm;
        case 4:
          this.f9_1 = 5;
          continue $sm;
        case 5:
          this.f9_1 = 6;
          continue $sm;
        case 6:
          this.g9_1 = 29;
          this.g9_1 = 28;
          var tmp_2 = this;
          tmp_2.i30_1 = this.e30_1;
          this.j30_1 = this.i30_1.p();
          this.f9_1 = 7;
          continue $sm;
        case 7:
          this.f9_1 = 8;
          suspendResult = this.j30_1.k14(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 8:
          if (!suspendResult) {
            this.f9_1 = 26;
            continue $sm;
          }

          this.k30_1 = this.j30_1.r();
          this.f9_1 = 9;
          continue $sm;
        case 9:
          var tmp_3 = this;
          tmp_3.m30_1 = this.k30_1;
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.l2k('WebSocketSession(' + toString(this.w2z_1) + ') receiving frame ' + this.m30_1.toString());
          }

          this.n30_1 = this.m30_1;
          var tmp_4 = this.n30_1;
          if (tmp_4 instanceof Close) {
            if (!this.u2z_1.g2x().m14()) {
              this.f9_1 = 18;
              var tmp_5 = this.u2z_1.g2x();
              var tmp1_elvis_lhs = readReason(this.m30_1);
              suspendResult = tmp_5.m17(Close_init_$Create$(tmp1_elvis_lhs == null ? get_NORMAL_CLOSE() : tmp1_elvis_lhs), this);
              if (suspendResult === get_COROUTINE_SUSPENDED()) {
                return suspendResult;
              }
              continue $sm;
            } else {
              this.f9_1 = 19;
              continue $sm;
            }
          } else {
            var tmp_6 = this.n30_1;
            if (tmp_6 instanceof Pong) {
              this.p30_1 = this.u2z_1.k2y_1.kotlinx$atomicfu$value;
              if (this.p30_1 == null) {
                this.q30_1 = null;
                this.f9_1 = 17;
                continue $sm;
              } else {
                this.f9_1 = 16;
                suspendResult = this.p30_1.m17(this.m30_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              }
            } else {
              var tmp_7 = this.n30_1;
              if (tmp_7 instanceof Ping) {
                this.f9_1 = 15;
                suspendResult = this.v2z_1.m17(this.m30_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              } else {
                this.f9_1 = 10;
                suspendResult = checkMaxFrameSize(this.u2z_1, this.y2z_1, this.m30_1, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              }
            }
          }

        case 10:
          if (!this.m30_1.y30_1) {
            if (this.x2z_1 == null) {
              this.x2z_1 = this.m30_1;
            }
            if (this.y2z_1 == null) {
              this.y2z_1 = BytePacketBuilder();
            }
            writeFully(ensureNotNull(this.y2z_1), this.m30_1.a31_1);
            this.l30_1 = Unit_instance;
            this.f9_1 = 21;
            continue $sm;
          } else {
            this.f9_1 = 11;
            continue $sm;
          }

        case 11:
          if (this.x2z_1 == null) {
            this.f9_1 = 14;
            suspendResult = this.u2z_1.m2y_1.m17(processIncomingExtensions(this.u2z_1, this.m30_1), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 12;
            continue $sm;
          }

        case 12:
          writeFully(ensureNotNull(this.y2z_1), this.m30_1.a31_1);
          this.r30_1 = Companion_getInstance_2().g31(true, ensureNotNull(this.x2z_1).z30_1, readByteArray(build(ensureNotNull(this.y2z_1))), ensureNotNull(this.x2z_1).c31_1, ensureNotNull(this.x2z_1).d31_1, ensureNotNull(this.x2z_1).e31_1);
          this.x2z_1 = null;
          this.f9_1 = 13;
          suspendResult = this.u2z_1.m2y_1.m17(processIncomingExtensions(this.u2z_1, this.r30_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 13:
          var tmp_8 = this;
          tmp_8.o30_1 = Unit_instance;
          this.f9_1 = 20;
          continue $sm;
        case 14:
          this.l30_1 = Unit_instance;
          this.f9_1 = 21;
          continue $sm;
        case 15:
          var tmp_9 = this;
          tmp_9.o30_1 = Unit_instance;
          this.f9_1 = 20;
          continue $sm;
        case 16:
          var tmp_10 = this;
          tmp_10.q30_1 = Unit_instance;
          this.f9_1 = 17;
          continue $sm;
        case 17:
          this.o30_1 = this.q30_1;
          this.f9_1 = 20;
          continue $sm;
        case 18:
          this.f9_1 = 19;
          continue $sm;
        case 19:
          this.z2z_1 = true;
          this.h30_1 = Unit_instance;
          this.f9_1 = 22;
          var tmp_11 = this;
          continue $sm;
        case 20:
          if (false) {
            this.f9_1 = 9;
            continue $sm;
          }

          this.f9_1 = 21;
          continue $sm;
        case 21:
          this.f9_1 = 7;
          continue $sm;
        case 22:
          this.g9_1 = 32;
          var tmp_12 = this;
          cancelConsumed(this.e30_1, this.f30_1);
          tmp_12.b30_1 = Unit_instance;
          this.g9_1 = 39;
          this.f9_1 = 23;
          continue $sm;
        case 23:
          this.g9_1 = 39;
          this.v2z_1.w17();
          var tmp0_safe_receiver = this.y2z_1;
          if (tmp0_safe_receiver == null)
            null;
          else {
            tmp0_safe_receiver.l1j();
          }

          this.u2z_1.m2y_1.w17();
          if (!this.z2z_1) {
            this.f9_1 = 24;
            suspendResult = close(this.u2z_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 25;
            continue $sm;
          }

        case 24:
          this.f9_1 = 25;
          continue $sm;
        case 25:
          var tmp_13 = this;
          return Unit_instance;
        case 26:
          this.g30_1 = Unit_instance;
          this.f9_1 = 27;
          var tmp_14 = this;
          continue $sm;
        case 27:
          this.g9_1 = 32;
          var tmp_15 = this;
          cancelConsumed(this.e30_1, this.f30_1);
          tmp_15.d30_1 = Unit_instance;
          this.f9_1 = 31;
          continue $sm;
        case 28:
          this.g9_1 = 29;
          var tmp_16 = this.i9_1;
          if (tmp_16 instanceof Error) {
            this.s30_1 = this.i9_1;
            var tmp_17 = this;
            this.f30_1 = this.s30_1;
            throw this.s30_1;
          } else {
            throw this.i9_1;
          }

        case 29:
          this.g9_1 = 32;
          this.t30_1 = this.i9_1;
          cancelConsumed(this.e30_1, this.f30_1);
          throw this.t30_1;
        case 30:
          this.g9_1 = 32;
          cancelConsumed(this.e30_1, this.f30_1);
          if (false) {
            this.f9_1 = 3;
            continue $sm;
          }

          this.f9_1 = 31;
          continue $sm;
        case 31:
          this.a30_1 = Unit_instance;
          this.g9_1 = 39;
          this.f9_1 = 36;
          continue $sm;
        case 32:
          this.g9_1 = 33;
          var tmp_18 = this.i9_1;
          if (tmp_18 instanceof ClosedSendChannelException) {
            this.u30_1 = this.i9_1;
            var tmp_19 = this;
            tmp_19.a30_1 = Unit_instance;
            this.g9_1 = 39;
            this.f9_1 = 36;
            continue $sm;
          } else {
            var tmp_20 = this.i9_1;
            if (tmp_20 instanceof Error) {
              this.v30_1 = this.i9_1;
              var tmp_21 = this;
              this.v2z_1.w17();
              tmp_21.a30_1 = this.u2z_1.m2y_1.u17(this.v30_1);
              this.g9_1 = 39;
              this.f9_1 = 36;
              continue $sm;
            } else {
              throw this.i9_1;
            }
          }

        case 33:
          this.g9_1 = 39;
          this.w30_1 = this.i9_1;
          this.v2z_1.w17();
          var tmp0_safe_receiver_0 = this.y2z_1;
          if (tmp0_safe_receiver_0 == null)
            null;
          else {
            tmp0_safe_receiver_0.l1j();
          }

          this.u2z_1.m2y_1.w17();
          if (!this.z2z_1) {
            this.f9_1 = 34;
            suspendResult = close(this.u2z_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 35;
            continue $sm;
          }

        case 34:
          this.f9_1 = 35;
          continue $sm;
        case 35:
          throw this.w30_1;
        case 36:
          this.x30_1 = this.a30_1;
          this.g9_1 = 39;
          this.v2z_1.w17();
          var tmp0_safe_receiver_1 = this.y2z_1;
          if (tmp0_safe_receiver_1 == null)
            null;
          else {
            tmp0_safe_receiver_1.l1j();
          }

          this.u2z_1.m2y_1.w17();
          if (!this.z2z_1) {
            this.f9_1 = 37;
            suspendResult = close(this.u2z_1, CloseReason_init_$Create$(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 38;
            continue $sm;
          }

        case 37:
          this.f9_1 = 38;
          continue $sm;
        case 38:
          return Unit_instance;
        case 39:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 39) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda).l1r = function ($this$launch, completion) {
  var i = new DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this.u2z_1, this.v2z_1, completion);
  i.w2z_1 = $this$launch;
  return i;
};
function DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0(this$0, $ponger, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this$0, $ponger, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.k1r($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this$0, resultContinuation) {
  this.p31_1 = this$0;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).k1r = function ($this$launch, $completion) {
  var tmp = this.l1r($this$launch, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 10;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          this.g9_1 = 6;
          this.g9_1 = 3;
          this.f9_1 = 2;
          suspendResult = outgoingProcessorLoop(this.p31_1, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.r31_1 = suspendResult;
          this.g9_1 = 10;
          this.f9_1 = 8;
          continue $sm;
        case 3:
          this.g9_1 = 6;
          var tmp_0 = this.i9_1;
          if (tmp_0 instanceof ClosedSendChannelException) {
            this.s31_1 = this.i9_1;
            var tmp_1 = this;
            tmp_1.r31_1 = Unit_instance;
            this.g9_1 = 10;
            this.f9_1 = 8;
            continue $sm;
          } else {
            var tmp_2 = this.i9_1;
            if (tmp_2 instanceof ClosedReceiveChannelException) {
              this.t31_1 = this.i9_1;
              var tmp_3 = this;
              tmp_3.r31_1 = Unit_instance;
              this.g9_1 = 10;
              this.f9_1 = 8;
              continue $sm;
            } else {
              var tmp_4 = this.i9_1;
              if (tmp_4 instanceof CancellationException) {
                this.u31_1 = this.i9_1;
                this.f9_1 = 4;
                suspendResult = sendCloseSequence$default(this.p31_1, CloseReason_init_$Create$(Codes_NORMAL_getInstance(), ''), VOID, this);
                if (suspendResult === get_COROUTINE_SUSPENDED()) {
                  return suspendResult;
                }
                continue $sm;
              } else {
                var tmp_5 = this.i9_1;
                if (tmp_5 instanceof ChannelIOException) {
                  this.v31_1 = this.i9_1;
                  var tmp_6 = this;
                  tmp_6.r31_1 = Unit_instance;
                  this.g9_1 = 10;
                  this.f9_1 = 8;
                  continue $sm;
                } else {
                  var tmp_7 = this.i9_1;
                  if (tmp_7 instanceof Error) {
                    this.w31_1 = this.i9_1;
                    this.p31_1.n2y_1.jq(CancellationException_init_$Create$('Failed to send frame', this.w31_1));
                    this.f9_1 = 5;
                    suspendResult = closeExceptionally(this.p31_1.j2y_1, this.w31_1, this);
                    if (suspendResult === get_COROUTINE_SUSPENDED()) {
                      return suspendResult;
                    }
                    continue $sm;
                  } else {
                    throw this.i9_1;
                  }
                }
              }
            }
          }

        case 4:
          this.r31_1 = suspendResult;
          this.g9_1 = 10;
          this.f9_1 = 8;
          continue $sm;
        case 5:
          this.r31_1 = suspendResult;
          this.g9_1 = 10;
          this.f9_1 = 8;
          continue $sm;
        case 6:
          this.g9_1 = 10;
          this.x31_1 = this.i9_1;
          this.p31_1.n2y_1.y17();
          this.f9_1 = 7;
          suspendResult = close(this.p31_1.j2y_1, VOID, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 7:
          throw this.x31_1;
        case 8:
          this.g9_1 = 10;
          this.p31_1.n2y_1.y17();
          this.f9_1 = 9;
          suspendResult = close(this.p31_1.j2y_1, VOID, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 9:
          return Unit_instance;
        case 10:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 10) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda).l1r = function ($this$launch, completion) {
  var i = new DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this.p31_1, completion);
  i.q31_1 = $this$launch;
  return i;
};
function DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0(this$0, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this$0, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.k1r($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this$0, resultContinuation) {
  this.g32_1 = this$0;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).i32 = function (it, $completion) {
  var tmp = this.j32(it, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).x9 = function (p1, $completion) {
  return this.i32(p1 instanceof CloseReason ? p1 : THROW_CCE(), $completion);
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 2;
          this.f9_1 = 1;
          suspendResult = sendCloseSequence(this.g32_1, this.h32_1, IOException_init_$Create$('Ping timeout'), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          return Unit_instance;
        case 2:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 2) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda).j32 = function (it, completion) {
  var i = new DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this.g32_1, completion);
  i.h32_1 = it;
  return i;
};
function DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0(this$0, resultContinuation) {
  var i = new DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this$0, resultContinuation);
  var l = function (it, $completion) {
    return i.i32(it, $completion);
  };
  l.$arity = 1;
  return l;
}
function $outgoingProcessorLoopCOROUTINE$0(_this__u8e3s4, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.q2x_1 = _this__u8e3s4;
}
protoOf($outgoingProcessorLoopCOROUTINE$0).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 7;
          this.r2x_1 = this.q2x_1.n2y_1.p();
          this.f9_1 = 1;
          continue $sm;
        case 1:
          this.f9_1 = 2;
          suspendResult = this.r2x_1.k14(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          if (!suspendResult) {
            this.f9_1 = 6;
            continue $sm;
          }

          this.s2x_1 = this.r2x_1.r();
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.l2k('Sending ' + this.s2x_1.toString() + ' from session ' + toString(this.q2x_1));
          }

          this.t2x_1 = this.s2x_1;
          var tmp_0 = this.t2x_1;
          if (tmp_0 instanceof Close) {
            this.f9_1 = 3;
            suspendResult = sendCloseSequence$default(this.q2x_1, readReason(this.s2x_1), VOID, this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            var tmp_1;
            var tmp_2 = this.t2x_1;
            if (tmp_2 instanceof Text) {
              tmp_1 = true;
            } else {
              var tmp_3 = this.t2x_1;
              tmp_1 = tmp_3 instanceof Binary;
            }
            if (tmp_1) {
              this.u2x_1 = processOutgoingExtensions(this.q2x_1, this.s2x_1);
              this.f9_1 = 4;
              continue $sm;
            } else {
              this.u2x_1 = this.s2x_1;
              this.f9_1 = 4;
              continue $sm;
            }
          }

        case 3:
          this.f9_1 = 6;
          var tmp_4 = this;
          continue $sm;
        case 4:
          this.v2x_1 = this.u2x_1;
          this.f9_1 = 5;
          suspendResult = this.q2x_1.j2y_1.g2x().m17(this.v2x_1, this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 5:
          this.f9_1 = 1;
          continue $sm;
        case 6:
          return Unit_instance;
        case 7:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 7) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
function $sendCloseSequenceCOROUTINE$1(_this__u8e3s4, reason, exception, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.e2y_1 = _this__u8e3s4;
  this.f2y_1 = reason;
  this.g2y_1 = exception;
}
protoOf($sendCloseSequenceCOROUTINE$1).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 6;
          if (!tryClose(this.e2y_1))
            return Unit_instance;
          var this_0 = get_LOGGER();
          if (get_isTraceEnabled(this_0)) {
            this_0.l2k('Sending Close Sequence for session ' + toString(this.e2y_1) + ' with reason ' + toString_0(this.f2y_1) + ' and exception ' + toString_0(this.g2y_1));
          }

          this.e2y_1.p2y_1.wv();
          var tmp_0 = this;
          var tmp0_elvis_lhs = this.f2y_1;
          tmp_0.h2y_1 = tmp0_elvis_lhs == null ? CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '') : tmp0_elvis_lhs;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          this.g9_1 = 5;
          runOrCancelPinger(this.e2y_1);
          if (!(this.h2y_1.y2w_1 === Codes_CLOSED_ABNORMALLY_getInstance().u2w_1)) {
            this.f9_1 = 2;
            suspendResult = this.e2y_1.j2y_1.g2x().m17(Close_init_$Create$(this.h2y_1), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 3;
            continue $sm;
          }

        case 2:
          this.f9_1 = 3;
          continue $sm;
        case 3:
          this.i2y_1 = Unit_instance;
          this.g9_1 = 6;
          this.f9_1 = 4;
          continue $sm;
        case 4:
          this.g9_1 = 6;
          this.e2y_1.l2y_1.tv(this.h2y_1);
          if (!(this.g2y_1 == null)) {
            this.e2y_1.n2y_1.u17(this.g2y_1);
            this.e2y_1.m2y_1.u17(this.g2y_1);
          }

          return Unit_instance;
        case 5:
          this.g9_1 = 6;
          var t = this.i9_1;
          this.e2y_1.l2y_1.tv(this.h2y_1);
          if (!(this.g2y_1 == null)) {
            this.e2y_1.n2y_1.u17(this.g2y_1);
            this.e2y_1.m2y_1.u17(this.g2y_1);
          }

          throw t;
        case 6:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 6) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
function $checkMaxFrameSizeCOROUTINE$2(_this__u8e3s4, packet, frame, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.f2z_1 = _this__u8e3s4;
  this.g2z_1 = packet;
  this.h2z_1 = frame;
}
protoOf($checkMaxFrameSizeCOROUTINE$2).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 3;
          var tmp_0 = this;
          var tmp_1 = this.h2z_1.a31_1.length;
          var tmp0_safe_receiver = this.g2z_1;
          var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : get_size(tmp0_safe_receiver);
          tmp_0.i2z_1 = tmp_1 + (tmp1_elvis_lhs == null ? 0 : tmp1_elvis_lhs) | 0;
          if (toLong(this.i2z_1).g1(this.f2z_1.e2x()) > 0) {
            var tmp2_safe_receiver = this.g2z_1;
            if (tmp2_safe_receiver == null)
              null;
            else {
              tmp2_safe_receiver.l1j();
            }
            this.f9_1 = 2;
            suspendResult = close(this.f2z_1, CloseReason_init_$Create$(Codes_TOO_BIG_getInstance(), 'Frame is too big: ' + this.i2z_1 + '. Max size is ' + this.f2z_1.e2x().toString()), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 1;
            continue $sm;
          }

        case 1:
          return Unit_instance;
        case 2:
          throw new FrameTooBigException(toLong(this.i2z_1));
        case 3:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 3) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
function DefaultWebSocketSessionImpl(raw, pingIntervalMillis, timeoutMillis) {
  Companion_getInstance_0();
  this.j2y_1 = raw;
  this.k2y_1 = atomic$ref$1(null);
  this.l2y_1 = CompletableDeferred();
  this.m2y_1 = Channel(8);
  this.n2y_1 = Channel(get_OUTGOING_CHANNEL_CAPACITY());
  this.o2y_1 = atomic$boolean$1(false);
  this.p2y_1 = Job(this.j2y_1.ap().s9(Key_instance));
  var tmp = this;
  // Inline function 'kotlin.collections.mutableListOf' call
  tmp.q2y_1 = ArrayList_init_$Create$();
  this.r2y_1 = atomic$boolean$1(false);
  this.s2y_1 = this.j2y_1.ap().qi(this.p2y_1).qi(new CoroutineName('ws-default'));
  this.t2y_1 = pingIntervalMillis;
  this.u2y_1 = timeoutMillis;
  this.v2y_1 = this.l2y_1;
}
protoOf(DefaultWebSocketSessionImpl).f2x = function () {
  return this.m2y_1;
};
protoOf(DefaultWebSocketSessionImpl).g2x = function () {
  return this.n2y_1;
};
protoOf(DefaultWebSocketSessionImpl).j2z = function () {
  return this.q2y_1;
};
protoOf(DefaultWebSocketSessionImpl).ap = function () {
  return this.s2y_1;
};
protoOf(DefaultWebSocketSessionImpl).d2x = function (value) {
  this.j2y_1.d2x(value);
};
protoOf(DefaultWebSocketSessionImpl).e2x = function () {
  return this.j2y_1.e2x();
};
protoOf(DefaultWebSocketSessionImpl).b2x = function () {
  return this.v2y_1;
};
protoOf(DefaultWebSocketSessionImpl).c2x = function (negotiatedExtensions) {
  if (!this.r2y_1.atomicfu$compareAndSet(false, true)) {
    // Inline function 'kotlin.error' call
    var message = 'WebSocket session ' + toString(this) + ' is already started.';
    throw IllegalStateException_init_$Create$(toString(message));
  }
  // Inline function 'io.ktor.util.logging.trace' call
  var this_0 = get_LOGGER();
  if (get_isTraceEnabled(this_0)) {
    // Inline function 'io.ktor.websocket.DefaultWebSocketSessionImpl.start.<anonymous>' call
    var tmp$ret$0 = 'Starting default WebSocketSession(' + toString(this) + ') ' + ('with negotiated extensions: ' + joinToString(negotiatedExtensions));
    this_0.l2k(tmp$ret$0);
  }
  this.q2y_1.t(negotiatedExtensions);
  runOrCancelPinger(this);
  runIncomingProcessor(this, ponger(this, this.g2x()));
  runOutgoingProcessor(this);
};
protoOf(DefaultWebSocketSessionImpl).r1m = function ($completion) {
  return this.j2y_1.r1m($completion);
};
var properties_initialized_DefaultWebSocketSession_kt_6cjlhc;
function _init_properties_DefaultWebSocketSession_kt__469s0y() {
  if (!properties_initialized_DefaultWebSocketSession_kt_6cjlhc) {
    properties_initialized_DefaultWebSocketSession_kt_6cjlhc = true;
    LOGGER = KtorSimpleLogger('io.ktor.websocket.WebSocket');
    IncomingProcessorCoroutineName = new CoroutineName('ws-incoming-processor');
    OutgoingProcessorCoroutineName = new CoroutineName('ws-outgoing-processor');
    NORMAL_CLOSE = CloseReason_init_$Create$(Codes_NORMAL_getInstance(), 'OK');
  }
}
function NonDisposableHandle() {
}
protoOf(NonDisposableHandle).os = function () {
  return Unit_instance;
};
protoOf(NonDisposableHandle).toString = function () {
  return 'NonDisposableHandle';
};
protoOf(NonDisposableHandle).hashCode = function () {
  return 207988788;
};
protoOf(NonDisposableHandle).equals = function (other) {
  if (this === other)
    return true;
  if (!(other instanceof NonDisposableHandle))
    return false;
  other instanceof NonDisposableHandle || THROW_CCE();
  return true;
};
var NonDisposableHandle_instance;
function NonDisposableHandle_getInstance() {
  return NonDisposableHandle_instance;
}
function readText_0(_this__u8e3s4) {
  // Inline function 'kotlin.require' call
  // Inline function 'kotlin.contracts.contract' call
  if (!_this__u8e3s4.y30_1) {
    // Inline function 'io.ktor.websocket.readText.<anonymous>' call
    var message = 'Text could be only extracted from non-fragmented frame';
    throw IllegalArgumentException_init_$Create$(toString(message));
  }
  var tmp = Charsets_getInstance().o1r_1.r1r();
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  // Inline function 'io.ktor.websocket.readText.<anonymous>' call
  writeFully(builder, _this__u8e3s4.a31_1);
  return decode(tmp, builder);
}
function readReason(_this__u8e3s4) {
  if (_this__u8e3s4.a31_1.length < 2) {
    return null;
  }
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  // Inline function 'io.ktor.websocket.readReason.<anonymous>' call
  writeFully(builder, _this__u8e3s4.a31_1);
  var packet = builder;
  var code = packet.d1i();
  var message = readText(packet);
  return new CloseReason(code, message);
}
function FrameTooBigException(frameSize) {
  Exception_init_$Init$(this);
  captureStack(this, FrameTooBigException);
  this.k32_1 = frameSize;
}
protoOf(FrameTooBigException).v9 = function () {
  return 'Frame is too big: ' + this.k32_1.toString();
};
protoOf(FrameTooBigException).fw = function () {
  // Inline function 'kotlin.also' call
  var this_0 = new FrameTooBigException(this.k32_1);
  // Inline function 'kotlin.contracts.contract' call
  // Inline function 'io.ktor.websocket.FrameTooBigException.createCopy.<anonymous>' call
  initCauseBridge(this_0, this);
  return this_0;
};
var FrameType_TEXT_instance;
var FrameType_BINARY_instance;
var FrameType_CLOSE_instance;
var FrameType_PING_instance;
var FrameType_PONG_instance;
function Companion_1() {
  Companion_instance_1 = this;
  var tmp = this;
  var tmp$ret$0;
  $l$block_0: {
    // Inline function 'kotlin.collections.maxByOrNull' call
    var iterator = get_entries_0().p();
    if (!iterator.q()) {
      tmp$ret$0 = null;
      break $l$block_0;
    }
    var maxElem = iterator.r();
    if (!iterator.q()) {
      tmp$ret$0 = maxElem;
      break $l$block_0;
    }
    // Inline function 'io.ktor.websocket.Companion.maxOpcode.<anonymous>' call
    var maxValue = maxElem.o32_1;
    do {
      var e = iterator.r();
      // Inline function 'io.ktor.websocket.Companion.maxOpcode.<anonymous>' call
      var v = e.o32_1;
      if (compareTo(maxValue, v) < 0) {
        maxElem = e;
        maxValue = v;
      }
    }
     while (iterator.q());
    tmp$ret$0 = maxElem;
  }
  tmp.p32_1 = ensureNotNull(tmp$ret$0).o32_1;
  var tmp_0 = this;
  var tmp_1 = 0;
  var tmp_2 = this.p32_1 + 1 | 0;
  // Inline function 'kotlin.arrayOfNulls' call
  var tmp_3 = fillArrayVal(Array(tmp_2), null);
  while (tmp_1 < tmp_2) {
    var tmp_4 = tmp_1;
    var tmp$ret$5;
    $l$block_2: {
      // Inline function 'kotlin.collections.singleOrNull' call
      var single = null;
      var found = false;
      var tmp0_iterator = get_entries_0().p();
      while (tmp0_iterator.q()) {
        var element = tmp0_iterator.r();
        // Inline function 'io.ktor.websocket.Companion.byOpcodeArray.<anonymous>' call
        if (element.o32_1 === tmp_4) {
          if (found) {
            tmp$ret$5 = null;
            break $l$block_2;
          }
          single = element;
          found = true;
        }
      }
      if (!found) {
        tmp$ret$5 = null;
        break $l$block_2;
      }
      tmp$ret$5 = single;
    }
    tmp_3[tmp_4] = tmp$ret$5;
    tmp_1 = tmp_1 + 1 | 0;
  }
  tmp_0.q32_1 = tmp_3;
}
var Companion_instance_1;
function Companion_getInstance_1() {
  FrameType_initEntries();
  if (Companion_instance_1 == null)
    new Companion_1();
  return Companion_instance_1;
}
function values_0() {
  return [FrameType_TEXT_getInstance(), FrameType_BINARY_getInstance(), FrameType_CLOSE_getInstance(), FrameType_PING_getInstance(), FrameType_PONG_getInstance()];
}
function get_entries_0() {
  if ($ENTRIES_0 == null)
    $ENTRIES_0 = enumEntries(values_0());
  return $ENTRIES_0;
}
var FrameType_entriesInitialized;
function FrameType_initEntries() {
  if (FrameType_entriesInitialized)
    return Unit_instance;
  FrameType_entriesInitialized = true;
  FrameType_TEXT_instance = new FrameType('TEXT', 0, false, 1);
  FrameType_BINARY_instance = new FrameType('BINARY', 1, false, 2);
  FrameType_CLOSE_instance = new FrameType('CLOSE', 2, true, 8);
  FrameType_PING_instance = new FrameType('PING', 3, true, 9);
  FrameType_PONG_instance = new FrameType('PONG', 4, true, 10);
  Companion_getInstance_1();
}
var $ENTRIES_0;
function FrameType(name, ordinal, controlFrame, opcode) {
  Enum.call(this, name, ordinal);
  this.n32_1 = controlFrame;
  this.o32_1 = opcode;
}
function FrameType_TEXT_getInstance() {
  FrameType_initEntries();
  return FrameType_TEXT_instance;
}
function FrameType_BINARY_getInstance() {
  FrameType_initEntries();
  return FrameType_BINARY_instance;
}
function FrameType_CLOSE_getInstance() {
  FrameType_initEntries();
  return FrameType_CLOSE_instance;
}
function FrameType_PING_getInstance() {
  FrameType_initEntries();
  return FrameType_PING_instance;
}
function FrameType_PONG_getInstance() {
  FrameType_initEntries();
  return FrameType_PONG_instance;
}
function get_PongerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PongerCoroutineName;
}
var PongerCoroutineName;
function get_PingerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PingerCoroutineName;
}
var PingerCoroutineName;
function ponger(_this__u8e3s4, outgoing) {
  _init_properties_PingPong_kt__9aqxey();
  var channel = Channel(5);
  var tmp = get_PongerCoroutineName();
  launch(_this__u8e3s4, tmp, VOID, ponger$slambda_0(channel, outgoing, null));
  return channel;
}
function pinger(_this__u8e3s4, outgoing, periodMillis, timeoutMillis, onTimeout) {
  _init_properties_PingPong_kt__9aqxey();
  var actorJob = Job();
  var channel = Channel(2147483647);
  var tmp = actorJob.qi(get_PingerCoroutineName());
  launch(_this__u8e3s4, tmp, VOID, pinger$slambda_0(periodMillis, timeoutMillis, onTimeout, channel, outgoing, null));
  var tmp_0 = ensureNotNull(_this__u8e3s4.ap().s9(Key_instance));
  tmp_0.dq(pinger$lambda(actorJob));
  return channel;
}
function ponger$slambda($channel, $outgoing, resultContinuation) {
  this.z32_1 = $channel;
  this.a33_1 = $outgoing;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(ponger$slambda).k1r = function ($this$launch, $completion) {
  var tmp = this.l1r($this$launch, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(ponger$slambda).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(ponger$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 14;
          this.g9_1 = 13;
          var tmp_0 = this;
          tmp_0.c33_1 = this.z32_1;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          var tmp_1 = this;
          tmp_1.e33_1 = this.c33_1;
          this.f33_1 = null;
          this.f9_1 = 2;
          continue $sm;
        case 2:
          this.f9_1 = 3;
          continue $sm;
        case 3:
          this.g9_1 = 10;
          this.g9_1 = 9;
          var tmp_2 = this;
          tmp_2.h33_1 = this.e33_1;
          this.i33_1 = this.h33_1.p();
          this.f9_1 = 4;
          continue $sm;
        case 4:
          this.f9_1 = 5;
          suspendResult = this.i33_1.k14(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 5:
          if (!suspendResult) {
            this.f9_1 = 7;
            continue $sm;
          }

          this.j33_1 = this.i33_1.r();
          var tmp_3 = this;
          tmp_3.k33_1 = this.j33_1;
          get_LOGGER().l2k('Received ping message, sending pong message');
          this.f9_1 = 6;
          suspendResult = this.a33_1.m17(new Pong(this.k33_1.a31_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 6:
          this.f9_1 = 4;
          continue $sm;
        case 7:
          this.g33_1 = Unit_instance;
          this.f9_1 = 8;
          var tmp_4 = this;
          continue $sm;
        case 8:
          this.g9_1 = 13;
          var tmp_5 = this;
          cancelConsumed(this.e33_1, this.f33_1);
          tmp_5.d33_1 = Unit_instance;
          this.f9_1 = 12;
          continue $sm;
        case 9:
          this.g9_1 = 10;
          var tmp_6 = this.i9_1;
          if (tmp_6 instanceof Error) {
            var e = this.i9_1;
            var tmp_7 = this;
            this.f33_1 = e;
            throw e;
          } else {
            throw this.i9_1;
          }

        case 10:
          this.g9_1 = 13;
          var t = this.i9_1;
          cancelConsumed(this.e33_1, this.f33_1);
          throw t;
        case 11:
          this.g9_1 = 13;
          cancelConsumed(this.e33_1, this.f33_1);
          if (false) {
            this.f9_1 = 1;
            continue $sm;
          }

          this.f9_1 = 12;
          continue $sm;
        case 12:
          this.g9_1 = 14;
          this.f9_1 = 15;
          continue $sm;
        case 13:
          this.g9_1 = 14;
          var tmp_8 = this.i9_1;
          if (tmp_8 instanceof ClosedSendChannelException) {
            var _unused_var__etf5q3 = this.i9_1;
            this.f9_1 = 15;
            continue $sm;
          } else {
            throw this.i9_1;
          }

        case 14:
          throw this.i9_1;
        case 15:
          this.g9_1 = 14;
          return Unit_instance;
      }
    } catch ($p) {
      var e_0 = $p;
      if (this.g9_1 === 14) {
        throw e_0;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e_0;
      }
    }
   while (true);
};
protoOf(ponger$slambda).l1r = function ($this$launch, completion) {
  var i = new ponger$slambda(this.z32_1, this.a33_1, completion);
  i.b33_1 = $this$launch;
  return i;
};
function ponger$slambda_0($channel, $outgoing, resultContinuation) {
  var i = new ponger$slambda($channel, $outgoing, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.k1r($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda$slambda($channel, resultContinuation) {
  this.t33_1 = $channel;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda$slambda).k1r = function ($this$withTimeoutOrNull, $completion) {
  var tmp = this.l1r($this$withTimeoutOrNull, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(pinger$slambda$slambda).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 3;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          if (!true) {
            this.f9_1 = 4;
            continue $sm;
          }

          this.f9_1 = 2;
          suspendResult = this.t33_1.q17(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.f9_1 = 1;
          continue $sm;
        case 3:
          throw this.i9_1;
        case 4:
          return Unit_instance;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 3) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda$slambda).l1r = function ($this$withTimeoutOrNull, completion) {
  var i = new pinger$slambda$slambda(this.t33_1, completion);
  i.u33_1 = $this$withTimeoutOrNull;
  return i;
};
function pinger$slambda$slambda_0($channel, resultContinuation) {
  var i = new pinger$slambda$slambda($channel, resultContinuation);
  var l = function ($this$withTimeoutOrNull, $completion) {
    return i.k1r($this$withTimeoutOrNull, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda$slambda_1($outgoing, $pingMessage, $channel, resultContinuation) {
  this.d34_1 = $outgoing;
  this.e34_1 = $pingMessage;
  this.f34_1 = $channel;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda$slambda_1).k1r = function ($this$withTimeoutOrNull, $completion) {
  var tmp = this.l1r($this$withTimeoutOrNull, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(pinger$slambda$slambda_1).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda$slambda_1).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 6;
          get_LOGGER().l2k('WebSocket Pinger: sending ping frame');
          this.f9_1 = 1;
          suspendResult = this.d34_1.m17(new Ping(toByteArray(this.e34_1, Charsets_getInstance().p1r_1)), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          this.f9_1 = 2;
          continue $sm;
        case 2:
          if (!true) {
            this.f9_1 = 5;
            continue $sm;
          }

          this.f9_1 = 3;
          suspendResult = this.f34_1.q17(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 3:
          var msg = suspendResult;
          if (decodeToString(msg.a31_1, 0, 0 + msg.a31_1.length | 0) === this.e34_1) {
            get_LOGGER().l2k('WebSocket Pinger: received valid pong frame ' + msg.toString());
            this.f9_1 = 5;
            continue $sm;
          } else {
            this.f9_1 = 4;
            continue $sm;
          }

        case 4:
          get_LOGGER().l2k('WebSocket Pinger: received invalid pong frame ' + msg.toString() + ', continue waiting');
          this.f9_1 = 2;
          continue $sm;
        case 5:
          return Unit_instance;
        case 6:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 6) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda$slambda_1).l1r = function ($this$withTimeoutOrNull, completion) {
  var i = new pinger$slambda$slambda_1(this.d34_1, this.e34_1, this.f34_1, completion);
  i.g34_1 = $this$withTimeoutOrNull;
  return i;
};
function pinger$slambda$slambda_2($outgoing, $pingMessage, $channel, resultContinuation) {
  var i = new pinger$slambda$slambda_1($outgoing, $pingMessage, $channel, resultContinuation);
  var l = function ($this$withTimeoutOrNull, $completion) {
    return i.k1r($this$withTimeoutOrNull, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$slambda($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation) {
  this.p34_1 = $periodMillis;
  this.q34_1 = $timeoutMillis;
  this.r34_1 = $onTimeout;
  this.s34_1 = $channel;
  this.t34_1 = $outgoing;
  CoroutineImpl.call(this, resultContinuation);
}
protoOf(pinger$slambda).k1r = function ($this$launch, $completion) {
  var tmp = this.l1r($this$launch, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
};
protoOf(pinger$slambda).x9 = function (p1, $completion) {
  return this.k1r((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
};
protoOf(pinger$slambda).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 9;
          get_LOGGER().l2k('Starting WebSocket pinger coroutine with period ' + this.p34_1.toString() + ' ms and timeout ' + this.q34_1.toString() + ' ms');
          this.v34_1 = Random(getTimeMillis());
          this.w34_1 = new Int8Array(32);
          this.g9_1 = 7;
          this.f9_1 = 1;
          continue $sm;
        case 1:
          if (!true) {
            this.f9_1 = 6;
            continue $sm;
          }

          this.f9_1 = 2;
          suspendResult = withTimeoutOrNull(this.p34_1, pinger$slambda$slambda_0(this.s34_1, null), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.v34_1.aj(this.w34_1);
          this.x34_1 = '[ping ' + hex(this.w34_1) + ' ping]';
          this.f9_1 = 3;
          suspendResult = withTimeoutOrNull(this.q34_1, pinger$slambda$slambda_2(this.t34_1, this.x34_1, this.s34_1, null), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 3:
          this.y34_1 = suspendResult;
          if (this.y34_1 == null) {
            get_LOGGER().l2k('WebSocket pinger has timed out');
            this.f9_1 = 5;
            suspendResult = this.r34_1(CloseReason_init_$Create$(Codes_INTERNAL_ERROR_getInstance(), 'Ping timeout'), this);
            if (suspendResult === get_COROUTINE_SUSPENDED()) {
              return suspendResult;
            }
            continue $sm;
          } else {
            this.f9_1 = 4;
            continue $sm;
          }

        case 4:
          this.f9_1 = 1;
          continue $sm;
        case 5:
          this.f9_1 = 6;
          continue $sm;
        case 6:
          this.g9_1 = 9;
          this.f9_1 = 8;
          continue $sm;
        case 7:
          this.g9_1 = 9;
          var tmp_0 = this.i9_1;
          if (tmp_0 instanceof CancellationException) {
            var ignore = this.i9_1;
            this.f9_1 = 8;
            continue $sm;
          } else {
            var tmp_1 = this.i9_1;
            if (tmp_1 instanceof ClosedReceiveChannelException) {
              var ignore_0 = this.i9_1;
              this.f9_1 = 8;
              continue $sm;
            } else {
              var tmp_2 = this.i9_1;
              if (tmp_2 instanceof ClosedSendChannelException) {
                var ignore_1 = this.i9_1;
                this.f9_1 = 8;
                continue $sm;
              } else {
                throw this.i9_1;
              }
            }
          }

        case 8:
          this.g9_1 = 9;
          return Unit_instance;
        case 9:
          throw this.i9_1;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 9) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
protoOf(pinger$slambda).l1r = function ($this$launch, completion) {
  var i = new pinger$slambda(this.p34_1, this.q34_1, this.r34_1, this.s34_1, this.t34_1, completion);
  i.u34_1 = $this$launch;
  return i;
};
function pinger$slambda_0($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation) {
  var i = new pinger$slambda($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing, resultContinuation);
  var l = function ($this$launch, $completion) {
    return i.k1r($this$launch, $completion);
  };
  l.$arity = 1;
  return l;
}
function pinger$lambda($actorJob) {
  return function (it) {
    $actorJob.kq();
    return Unit_instance;
  };
}
var properties_initialized_PingPong_kt_fbfhmc;
function _init_properties_PingPong_kt__9aqxey() {
  if (!properties_initialized_PingPong_kt_fbfhmc) {
    properties_initialized_PingPong_kt_fbfhmc = true;
    PongerCoroutineName = new CoroutineName('ws-ponger');
    PingerCoroutineName = new CoroutineName('ws-pinger');
  }
}
function WebSocketExtension() {
}
function WebSocketExtensionsConfig() {
  var tmp = this;
  // Inline function 'kotlin.collections.mutableListOf' call
  tmp.b35_1 = ArrayList_init_$Create$();
  var tmp_0 = this;
  // Inline function 'kotlin.arrayOf' call
  // Inline function 'kotlin.js.unsafeCast' call
  // Inline function 'kotlin.js.asDynamic' call
  tmp_0.c35_1 = [false, false, false];
}
protoOf(WebSocketExtensionsConfig).l2m = function () {
  // Inline function 'kotlin.collections.map' call
  var this_0 = this.b35_1;
  // Inline function 'kotlin.collections.mapTo' call
  var destination = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_0, 10));
  var tmp0_iterator = this_0.p();
  while (tmp0_iterator.q()) {
    var item = tmp0_iterator.r();
    // Inline function 'io.ktor.websocket.WebSocketExtensionsConfig.build.<anonymous>' call
    var tmp$ret$0 = item();
    destination.k(tmp$ret$0);
  }
  return destination;
};
function parametersToString($this) {
  return $this.e35_1.h() ? '' : ', ' + joinToString($this.e35_1, ',');
}
function WebSocketExtensionHeader(name, parameters) {
  this.d35_1 = name;
  this.e35_1 = parameters;
}
protoOf(WebSocketExtensionHeader).toString = function () {
  return this.d35_1 + ' ' + parametersToString(this);
};
function parseWebSocketExtensions(value) {
  // Inline function 'kotlin.collections.map' call
  var this_0 = split(value, [',']);
  // Inline function 'kotlin.collections.mapTo' call
  var destination = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_0, 10));
  var tmp0_iterator = this_0.p();
  while (tmp0_iterator.q()) {
    var item = tmp0_iterator.r();
    // Inline function 'io.ktor.websocket.parseWebSocketExtensions.<anonymous>' call
    var extension = split(item, [';']);
    // Inline function 'kotlin.text.trim' call
    var this_1 = first(extension);
    var name = toString(trim(isCharSequence(this_1) ? this_1 : THROW_CCE()));
    // Inline function 'kotlin.collections.map' call
    var this_2 = drop(extension, 1);
    // Inline function 'kotlin.collections.mapTo' call
    var destination_0 = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_2, 10));
    var tmp0_iterator_0 = this_2.p();
    while (tmp0_iterator_0.q()) {
      var item_0 = tmp0_iterator_0.r();
      // Inline function 'io.ktor.websocket.parseWebSocketExtensions.<anonymous>.<anonymous>' call
      // Inline function 'kotlin.text.trim' call
      var tmp$ret$2 = toString(trim(isCharSequence(item_0) ? item_0 : THROW_CCE()));
      destination_0.k(tmp$ret$2);
    }
    var parameters = destination_0;
    var tmp$ret$5 = new WebSocketExtensionHeader(name, parameters);
    destination.k(tmp$ret$5);
  }
  return destination;
}
function send_0(_this__u8e3s4, content, $completion) {
  return _this__u8e3s4.h2x(Text_init_$Create$(content), $completion);
}
function close(_this__u8e3s4, reason, $completion) {
  reason = reason === VOID ? CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '') : reason;
  var tmp = new $closeCOROUTINE$3(_this__u8e3s4, reason, $completion);
  tmp.h9_1 = Unit_instance;
  tmp.i9_1 = null;
  return tmp.n9();
}
function WebSocketSession() {
}
function closeExceptionally(_this__u8e3s4, cause, $completion) {
  var tmp;
  if (cause instanceof CancellationException) {
    tmp = CloseReason_init_$Create$(Codes_NORMAL_getInstance(), '');
  } else {
    tmp = CloseReason_init_$Create$(Codes_INTERNAL_ERROR_getInstance(), cause.toString());
  }
  var reason = tmp;
  return close(_this__u8e3s4, reason, $completion);
}
function $closeCOROUTINE$3(_this__u8e3s4, reason, resultContinuation) {
  CoroutineImpl.call(this, resultContinuation);
  this.n35_1 = _this__u8e3s4;
  this.o35_1 = reason;
}
protoOf($closeCOROUTINE$3).n9 = function () {
  var suspendResult = this.h9_1;
  $sm: do
    try {
      var tmp = this.f9_1;
      switch (tmp) {
        case 0:
          this.g9_1 = 4;
          this.g9_1 = 3;
          this.f9_1 = 1;
          suspendResult = this.n35_1.h2x(Close_init_$Create$(this.o35_1), this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 1:
          this.f9_1 = 2;
          suspendResult = this.n35_1.r1m(this);
          if (suspendResult === get_COROUTINE_SUSPENDED()) {
            return suspendResult;
          }

          continue $sm;
        case 2:
          this.g9_1 = 4;
          this.f9_1 = 5;
          continue $sm;
        case 3:
          this.g9_1 = 4;
          var tmp_0 = this.i9_1;
          if (tmp_0 instanceof Error) {
            var _unused_var__etf5q3 = this.i9_1;
            this.f9_1 = 5;
            continue $sm;
          } else {
            throw this.i9_1;
          }

        case 4:
          throw this.i9_1;
        case 5:
          this.g9_1 = 4;
          return Unit_instance;
      }
    } catch ($p) {
      var e = $p;
      if (this.g9_1 === 4) {
        throw e;
      } else {
        this.f9_1 = this.g9_1;
        this.i9_1 = e;
      }
    }
   while (true);
};
function Binary_init_$Init$(fin, data, $this) {
  Binary.call($this, fin, data, false, false, false);
  return $this;
}
function Binary_init_$Create$(fin, data) {
  return Binary_init_$Init$(fin, data, objectCreate(protoOf(Binary)));
}
function Text_init_$Init$(fin, data, $this) {
  Text.call($this, fin, data, false, false, false);
  return $this;
}
function Text_init_$Init$_0(text, $this) {
  Text_init_$Init$(true, toByteArray(text), $this);
  return $this;
}
function Text_init_$Create$(text) {
  return Text_init_$Init$_0(text, objectCreate(protoOf(Text)));
}
function Close_init_$Init$(reason, $this) {
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  // Inline function 'io.ktor.websocket.Close.<init>.<anonymous>' call
  builder.j1j(reason.y2w_1);
  writeText(builder, reason.z2w_1);
  Close_init_$Init$_0(builder, $this);
  return $this;
}
function Close_init_$Create$(reason) {
  return Close_init_$Init$(reason, objectCreate(protoOf(Close)));
}
function Close_init_$Init$_0(packet, $this) {
  Close.call($this, readByteArray(packet));
  return $this;
}
function Close_init_$Init$_1($this) {
  Close.call($this, Companion_getInstance_2().f31_1);
  return $this;
}
function Close_init_$Create$_0() {
  return Close_init_$Init$_1(objectCreate(protoOf(Close)));
}
function Binary(fin, data, rsv1, rsv2, rsv3) {
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  Frame.call(this, fin, FrameType_BINARY_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
}
function Text(fin, data, rsv1, rsv2, rsv3) {
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  Frame.call(this, fin, FrameType_TEXT_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
}
function Close(data) {
  Frame.call(this, true, FrameType_CLOSE_getInstance(), data, NonDisposableHandle_instance, false, false, false);
}
function Ping(data) {
  Frame.call(this, true, FrameType_PING_getInstance(), data, NonDisposableHandle_instance, false, false, false);
}
function Pong(data, disposableHandle) {
  disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
  Frame.call(this, true, FrameType_PONG_getInstance(), data, disposableHandle, false, false, false);
}
function Companion_2() {
  Companion_instance_2 = this;
  this.f31_1 = new Int8Array(0);
}
protoOf(Companion_2).g31 = function (fin, frameType, data, rsv1, rsv2, rsv3) {
  var tmp;
  switch (frameType.v2_1) {
    case 1:
      tmp = new Binary(fin, data, rsv1, rsv2, rsv3);
      break;
    case 0:
      tmp = new Text(fin, data, rsv1, rsv2, rsv3);
      break;
    case 2:
      tmp = new Close(data);
      break;
    case 3:
      tmp = new Ping(data);
      break;
    case 4:
      tmp = new Pong(data, NonDisposableHandle_instance);
      break;
    default:
      noWhenBranchMatchedException();
      break;
  }
  return tmp;
};
var Companion_instance_2;
function Companion_getInstance_2() {
  if (Companion_instance_2 == null)
    new Companion_2();
  return Companion_instance_2;
}
function Frame(fin, frameType, data, disposableHandle, rsv1, rsv2, rsv3) {
  Companion_getInstance_2();
  disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
  rsv1 = rsv1 === VOID ? false : rsv1;
  rsv2 = rsv2 === VOID ? false : rsv2;
  rsv3 = rsv3 === VOID ? false : rsv3;
  this.y30_1 = fin;
  this.z30_1 = frameType;
  this.a31_1 = data;
  this.b31_1 = disposableHandle;
  this.c31_1 = rsv1;
  this.d31_1 = rsv2;
  this.e31_1 = rsv3;
}
protoOf(Frame).toString = function () {
  return 'Frame ' + this.z30_1.toString() + ' (fin=' + this.y30_1 + ', buffer len = ' + this.a31_1.length + ')';
};
function get_OUTGOING_CHANNEL_CAPACITY() {
  return 8;
}
//region block: post-declaration
protoOf(DefaultWebSocketSessionImpl).h2x = send;
defineProp(protoOf(FrameTooBigException), 'message', function () {
  return this.v9();
});
//endregion
//region block: init
NonDisposableHandle_instance = new NonDisposableHandle();
//endregion
//region block: exports
export {
  Codes_CLOSED_ABNORMALLY_getInstance as Codes_CLOSED_ABNORMALLY_getInstance1bzb878jpjbg8,
  Codes_NORMAL_getInstance as Codes_NORMAL_getInstance3dr9ood98owg7,
  send as send1mbirylegmq1f,
  close as close31bxp2d8eujlm,
  send_0 as send11768n4y74jwj,
  CloseReason_init_$Create$ as CloseReason_init_$Create$19yhime6q4sdx,
  Binary_init_$Create$ as Binary_init_$Create$1c9bipx4oyri7,
  Close_init_$Create$ as Close_init_$Create$1s9krjd24ykq6,
  Text_init_$Create$ as Text_init_$Create$dnevgba6vdmn,
  Companion_getInstance as Companion_getInstance200rusngf19yu,
  CloseReason as CloseReason10cphaqpp3ct7,
  DefaultWebSocketSession_0 as DefaultWebSocketSession2pi4wuih6mkcj,
  DefaultWebSocketSession as DefaultWebSocketSession3h8506yqzs5fx,
  Binary as Binary3tlzyfojm51s4,
  Close as Close3tx65evcwi73t,
  Ping as Ping3nta6l7sdq1r9,
  Pong as Pong3m3cas9hmc9ec,
  Text as Text3e6ukp9joohql,
  WebSocketExtensionsConfig as WebSocketExtensionsConfig3sf1f7u7xi63m,
  WebSocketExtension as WebSocketExtensionixqq2y77p4e0,
  WebSocketSession as WebSocketSessionzi1ianvyj32u,
  parseWebSocketExtensions as parseWebSocketExtensionszyo25w86ylog,
  readText_0 as readText30p9xkeoodw49,
};
//endregion

//# sourceMappingURL=ktor-ktor-shared-ktor-websockets.mjs.map
